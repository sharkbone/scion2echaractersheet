<!doctype html>
<html lang="en-us">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Devon J Kelley" />
<meta charset="UTF-8" />
<title>Scion 2e Character Manager</title>
<style>
body {
	font-family: "Trebuchet MS", sans-serif;
}
#content {
	border-radius: 15px;
	padding-top: 10px;
	margin-left: auto;
	margin-right: auto;
	text-align: center;
	max-width: 1200px;
	min-width: 400px;
	background-color: #A9C8D6;
}
ul {
	text-align: left;
	list-style-type: none;
	padding-left: 0px;
}
li {
	margin: 5px;
}
input {
	margin: 5px;
}
label {
	padding-right: 5px;
}
.card {
	margin: 7px;
	text-align: left;
	display: inline-block;
	padding: 7px;
	vertical-align: top;
}
.card li {
	text-align: right;
}
.smallcard {
	margin: 7px;
	text-align: left;
	display: inline-block;
	padding: 7px;
	vertical-align: top;
	max-width: 30%;
	word-wrap: break-word;
}
.skills {
	display: inline-block;
	margin-right: 10px;
	margin-left: 10px;
}
button {
	margin-right: 5px;
	background-color: #76A1B4;
	border: solid 1px #2E647B;
	border-radius: 5px;
}
button.lockable:disabled {
	background-color: transparent;
	border: none;
	color: black;
	font-weight: bold;
}
button.delete {
	color: red;
	font-weight: bolder;
	margin-left: 5px;
	background: none;
	border: none;
}
button.delete:hover {
	background-color: #D9E9F0;
}
button.delete:disabled {
	display: none;
}
button.plus:hover {
	background-color: #D9E9F0;
}
button.plus:disabled {
	display: none;
}
button.plus {
	color: green;
	font-weight: bolder;
	margin-left: 5px;
	background: none;
	border: none;
}
button.add:disabled, #birthrights:disabled, #bonds:disabled, #fatebindings:disabled {
	display: none;
}
button:hover {
	background-color: #D9E9F0;
}
button:disabled {
	background-color: transparent;
	border: none;
	color: black;
}
.heading {
	font-style: italic;
	color: #D9E9F0;
	margin-top: 0px;
	font-weight: bold;
}
.dot {
	height: .8em;
	width: .8em;
	border: solid 2px black;
	border-radius: 100%;
	display: inline-block;
}
.full {
	background-color: black;
}
.attr-dots {
	text-align: right;
}
details {
	display: inline;
}
.specialties {
	color: blue;
	text-decoration: underline;
}
.row {
	border: solid 2px #2E647B;
	border-radius: 15px;
	margin: 5px;
}
@media screen and (orientation: portrait) {
	.card{
		display: block;
		width: auto;
	}
	.smallcard {
		display: block;
		width: auto;
		max-width: 100%;
	}
}
</style>
</head>
<body>
<div id="content">

	<h1>Scion 2e Character Manager</h1>
	<p><button type="button" id="upload-char">Upload Character</button><button type="button" id="download-char">Download Character</button></p>
	<p style="position: sticky; top: 0px;"><button type="button" id="save-character">Save Character</button><button type="button" id="edit-lock">Lock Character</button></p>
	<div id="character-sheet">
		<!-- in order to make the sheet is responsive, we'll separate the parts with various divs -->

		<!-- I want to have various rows, so I'll divide those up with divs -->

		<div id="row-one" class="row">

		<div id="character-details" class="smallcard">
			<p class="heading">Character Details</p>
			<ul id="character-deets">
				<li><button id="set-name" class="edit lockable">Name:</button><span id="character-name">Bob</span></li>
				<li><button id="set-patron" class="edit lockable">Mantle/Patron:</button><span id="mantle-name">Mantle/Patron</span></li>
				<li><button id="set-player" class="edit lockable">Player:</button><span id="player-name">Brittney</span></li>
				<li><button id="set-chronicle" class="edit lockable">Chronicle:</button><span id="chronicle-name">Scion</span></li>
				<li><button id="set-pantheon" class="edit lockable">Pantheon:</button><span id="pantheon-name">Pantheon</span></li>
      </ul>
		</div>
		
		<div id="character-paths" class="smallcard">
			<p class="heading">Paths</p>
			<ul id="character-paths">
			<li><button id="set-path-1" class="edit lockable">Path 1:</button><span id="path1">Path 1</span></li>
			<li><button id="set-path-1" class="edit lockable">Path 2:</button><span id="path2">Path 2</span></li>
			<li><button id="set-path-1" class="edit lockable">Path 3:</button><span id="path3">Path 3</span></li>
		</ul>
		<p class="heading">Legendary Titles</p>
			<ul id="titles-list">
			</ul>
			<button type="button" id="titles" class="add lockable">Add Title</button>
		</div>
		
		<div id="character-deeds" class="smallcard">
			<p class="heading">Deeds</p>
			<ul>
			<li><button id="set-short" class="edit lockable">Short Term:</button><span id="short-deed">Deed</span></li>
			<li><button id="set-long" class="edit lockable">Long Term:</button><span id="long-deed">Deed</span></li>
			<li><button id="set-band" class="edit lockable">Band Deed:</button><span id="band-deed">Deed</span></li>
			</ul>
		</div>

		<!-- end of row one -->
	</div>

	<!-- row two will just be skills -->
	 <div id="row-two" class="row">

		<div id="skills" class="card">
			<p class="heading">Skills</p>
			<div id="skill-col-one" class="skills">
				<ul>
					<li><details><summary>Academics</summary><span class="specialties" id="academicsSpec">Specialties...</span></details> <span id="academics" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Athletics</summary><span class="specialties" id="athleticsSpec">Specialties...</span></details> <span id="athletics" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Close Combat</summary><span class="specialties" id="closeCombatSpec">Specialties...</span></details> <span id="closecombat" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Culture</summary><span class="specialties" id="cultureSpec">Specialties...</span></details> <span id="culture" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Empathy</summary><span class="specialties" id="empathySpec">Specialties...</span></details> <span id="empathy" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Firearms</summary><span class="specialties" id="firearmsSpec">Specialties...</span></details> <span id="firearms" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Integrity</summary><span class="specialties" id="integritySpec">Specialties...</span></details> <span id="integrity" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Leadership</summary><span class="specialties" id="leadershipSpec">Specialties...</span></details> <span id="leadership" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
				</ul>
			</div>
			<div id="skill-col-two" class="skills">
				<ul>
					<li><details><summary>Medicine</summary><span class="specialties" id="medicineSpec">Specialties...</span></details> <span id="medicine" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Occult</summary><span class="specialties" id="occultSpec">Specialties...</span></details> <span id="occult" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Persuasion</summary><span class="specialties" id="persuasionSpec">Specialties...</span></details> <span id="persuasion" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Pilot</summary><span class="specialties" id="pilotSpec">Specialties...</span></details> <span id="pilot" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Science</summary><span class="specialties" id="scienceSpec">Specialties...</span></details> <span id="science" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Subterfuge</summary><span class="specialties" id="subterfugeSpec">Specialties...</span></details> <span id="subterfuge" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Survival</summary><span class="specialties" id="survivalSpec">Specialties...</span></details> <span id="survival" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
					<li><details><summary>Technology</summary><span class="specialties" id="technologySpec">Specialties...</span></details> <span id="technology" class="attr-dots">
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
						<span class="dot"></span>
					</span></li>
				</ul>
			</div>
			<p id="specialtiesEditor"></p>
		</div>

		<!-- end of row two -->
	</div>

	<!-- row three will just be attributes -->
	 <div id="row-three" class="row">
		
		<div id="character-attributes" class="card">
				<p class="heading">Attributes</p>
				<div id="attr-col-one" class="skills">
					<ul>
						<li></li>
						<li>POWER</li>
						<li>FINESSE</li>
						<li>RESISTANCE</li>
					</ul>
				</div>
				<div id="attr-col-two" class="skills">
					<ul>
						<li>MENTAL</li>
						<li>Intellect <span id="intellect" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Cunning <span id="cunning" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Resolve <span id="resolve" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
					</ul>
				</div>
				<div id="attr-col-three" class="skills">
					<ul>
						<li>PHYSICAL</li>
						<li>Might <span id="might" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Dexterity <span id="dexterity" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Stamina <span id="stamina" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
					</ul>
				</div>
				<div id="attr-col-four" class="skills">
					<ul>
						<li>SOCIAL</li>
						<li>Presence <span id="presence" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Manipulation <span id="manipulation" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
						<li>Composure <span id="composure" class="attr-dots">
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
							<span class="dot"></span>
						</span></li>
					</ul>
				</div>
        </div>

		<!-- end of row three -->
	</div>

	<!-- row four -->
	 <div id="row-four" class="row">

		<!-- Callings! I can't forget Callings. And, I did forget them, but HERE THEY ARE! -->
		<div id="callings" class="smallcard">
			<p class="heading">Callings</p>
			<ul>
				<li><button id="calling-1" type="button" class="lockable">Calling 1</button>
					<span class="dot calling-1-dots"></span>
					<span class="dot calling-1-dots"></span>
					<span class="dot calling-1-dots"></span>
					<span class="dot calling-1-dots"></span>
					<span class="dot calling-1-dots"></span>
				</li>
				<li><button id="calling-2" type="button" class="lockable">Calling 2</button>
					<span class="dot calling-2-dots"></span>
					<span class="dot calling-2-dots"></span>
					<span class="dot calling-2-dots"></span>
					<span class="dot calling-2-dots"></span>
					<span class="dot calling-2-dots"></span>
				</li>
				<li><button id="calling-3" type="button" class="lockable">Calling 3</button>
					<span class="dot calling-3-dots"></span>
					<span class="dot calling-3-dots"></span>
					<span class="dot calling-3-dots"></span>
					<span class="dot calling-3-dots"></span>
					<span class="dot calling-3-dots"></span>
				</li>
			</ul>
			<p id="callingInput"></p>
		 </div>

		<!-- Can't forget the Legend attribute!-->
		<div id="character-legend" class="card">
			<p class="heading">Legend</p>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
			<span class="dot legend-dots"></span>
		</div>

		<div id="character-virtue" class="card">
			<p class="heading">Virtues</p>
			<p><button type="button" class="virtue-button lockable" id="virtue1">Virtue 1</button>
				<span>
				<span class="dot virtue-dots"></span>
				<span class="dot virtue-dots"></span>
				<span class="dot virtue-dots"></span>
				<span class="dot virtue-dots"></span>
				<span class="dot virtue-dots"></span>
				</span>
			<button type="button" class="virtue-button lockable" id="virtue2">Virtue 2</button></p>
			<p id="virtue-input"></p>
		</div>
	</div>
		<!-- end of row four -->

		<!-- row five -->
		 <div id="row-five" class="row">

		<div id="character-knacks" class="smallcard">
			<p class="heading">Knacks</p>
			<ul id="knacks-list">
			</ul>
			<button id="knacks" type="button" class="add lockable">Add Knack</button>
		</div>

		<div id="character-birthrights" class="card">
			<p class="heading">Birthrights</p>
			<ul id="birthrights-list">
			</ul>
			<button id="birthrights" type="button" class="lockable">Add Birthright</button>
		</div>

		<div id="character-purviews" class="smallcard">
			<p class="heading">Purviews</p>
			<ul id="purviews-list">
			</ul>
			<button id="purviews" type="button" class="add lockable">Add Purview</button>
		</div>
		
		<div id="character-boons" class="smallcard">
			<p class="heading">Boons</p>
			<ul id="boons-list">
			</ul>
			<button id="boons" type="button" class="add lockable">Add Purview</button>
		</div>

	<!-- end of row five -->
	</div>
	
	<!-- start of row 6 -->
	<div id="row-six" class="row">

		<!-- the equipment card -->
		<div id="equipment" class="card">
			<p class="heading">Equipment</p>
			<ul id="equipment-list"></ul>
			<button id="equipment" class="add lockable">Add Equipment</button>
		</div>
	
		<!-- the experience points card -->
		<div id="experience" class="smallcard">
			<p class="heading">Experience</p>
			<ul id="experience-list">
			<li><strong>Unspent XP:</strong> <span id="unspent-xp">0</span><button type=button class="delete lockable" id="spend-xp">spend</button></li>
			<li><strong>Spent XP:</strong> <span id="spent-xp">0</span></li>
			<li><strong>Total XP:</strong> <span id="total-xp">0</span><button type="button" class="plus lockable" id="add-xp">add</button></li>
			</ul>
			<p id="xp-input"></p>
			<p class="heading">Combat #s</p>
			<ul>
				<li><strong>Movement Dice:</strong> <span id="movement">0</span></li>
				<li><strong>Defense Dice:</strong> <span id="defense">0</span></li>
			</ul>
		</div>
		
		<!-- the Health/Conditions card -->
		<div id="conditions" class="smallcard">
			<p class="heading">Health & Conditions</p>
			<ul id="health-list">
			<li><button id="bashingOne" class="edit lockable">Bashing</button><span id="bashing-1"></span> <em>+1d</em></li>
			<li><button id="bashingTwo" class="edit lockable">Bashing</button><span id="bashing-2"></span> <em>+1d</em></li>
			<li><button id="bashingThree" class="edit lockable">Bashing</button><span id="bashing-3"></span> <em>+1d</em></li>
			<li><button id="injuredButt" class="edit lockable">Injured</button><span id="injured"></span> <em>+2d</em></li>
			<li><button id="maimedButt" class="edit lockable">Maimed</button><span id="maimed"></span> <em>+4d</em></li>
			<li><button id="takenOutButt" class="edit lockable">Taken Out</button><span id="taken-out"></span> ---</li>
			</ul>
			<p><button id="conditions" type="button" class="add lockable">Add Condition</button></p>
			<ul id="conditions-list">
			</ul>
		</div>
		
	<!-- end of row six -->
	</div>

	<!-- I'm not going to number the rows anymore, so I don't have to keep going back and changing the numbers. This row is for People -->
	 <div class="row">
		<div class="smallcard">
			<p class="heading">Bonds</p>
			<p>
			<ul id="bonds-list">
				<!-- Javascript will populate the list -->
			</ul>
			<button type="button" class="lockable" id="bonds">Add Bond</button>
			</p>
		</div>

		<div class="smallcard">
			<p class="heading">Fatebindings</p>
			<p>
			<ul id="fatebinding-list">
				<!-- JS will populate the list -->
			</ul>
			<button type="button" class="lockable" id="fatebindings">Add Fatebinding</button>
			</p>
		</div>
		</div>
	 </div>

	<!-- Row seven, only for notes -->
	<div id="row-seven" class="row"style="text-align: left; padding: 5px;">
		<p class="heading">Character Notes <button id="notes" type="button" class="add lockable">Add Note</button></p>
		<ul id="notes-list"></ul>
	</div>
		
</div>
</body>
<script>
// localStorage.removeItem("character");

/* THIS SECTION IS FOR THE CHARACTER OBJECT */
let character = {
	details : {
		name: {id : "character-name", value : "Roger"},
		mantle : {id : "mantle-name", value : "The Shrubber"},
		player : {id : "player-name", value : "Knight of Nee"},
		chronicle : {id : "chronicle-name", value : "Quest for the Holy Grail"},
		pantheon : {id: "pantheon-name", value : "Mont E. Python"}
	},

	paths : {
		path1 : {id : "path1", value : "A lonely traveler."},
		path2 : {id : "path2", value : "A shrubber by trade."},
		path3 : {id : "path3", value : "Protector of old women."}
	},

	deeds : {
		shortDeed : {id : "short-deed", value : "Find out the airspeed of a swallow."},
		longDeed : {id : "long-deed", value : "Chop down a tree with a herring."},
		bandDeed : {id: "band-deed", value : "To seek the holy grail!"}
	},
	
	// combining the skills and attributes into a property called 'dots' so I can more easily iterate through them.
	dots : {

	skills : {
		academics : {id : "academics", rating : 0, specialties : ""},
		athletics : {id : "athletics", rating : 0, specialties : ""}, 
		closeCombat : {id : "closecombat", rating : 0, specialties : ""},
		culture : {id : "culture", rating : 0, specialties : ""},
		empathy : {id : "empathy", rating : 0, specialties : ""}, 
		firearms : {id : "firearms", rating : 0, specialties : ""},
		integrity : {id : "integrity", rating : 0, specialties : ""},
		leadership : {id : "leadership", rating : 0, specialties : ""},
		medicine : {id : "medicine", rating : 0, specialties : ""},
		occult : {id : "occult", rating : 0, specialties : ""},
		persuasion : {id : "persuasion", rating : 0, specialties : ""},
		pilot : {id : "pilot", rating : 0, specialties : ""},
		science : {id : "science", rating : 0, specialties : ""},
		subterfuge : {id : "subterfuge", rating : 0, specialties : ""},
		survival : {id : "survival", rating : 0, specialties : ""},
		technology : {id : "technology", rating : 0, specialties : ""}
	},

	attributes : {
		intellect : {id : "intellect", rating : 1},
		cunning : {id : "cunning", rating : 1},
		resolve : {id : "resolve", rating : 1},
		might : {id : "might", rating : 1},
		dexterity : {id: "dexterity", rating : 1},
		stamina : {id : "stamina", rating : 1},
		presence : {id : "presence", rating : 1},
		manipulation : {id : "manipulation", rating : 1},
		composure : {id : "composure", rating : 1}
	}},
	// end of the 'dots' property

	virtues : {
		virtue1 : "",
		virtue2 : "",
		rating : 3
	},

	birthrights : {
		id : "birthrights-list", list : [["This is a Birthright", 1]]
	},
	
	lists : {
		knacks : {id : "knacks-list", list : ["This is a knack."]},
		purviews : {id : "purviews-list", list : ["This is a purview."]},
		boons : {id : "boons-list", list : ["This is a boon."]},
		conditions : {id : "conditions-list", list : ["This is a condition."]},
		titles : {id : "titles-list", list : ["This is a Legendary Title"]},
		notes : { id : "notes-list", list : ["This is a note."]},
		equipment : { id : "equipment-list", list : ["This is equipment. (Brutal, Melee)"]}
	},
	
	xp : {
		unspent : {id : "unspent-xp", value : 0},
		spent : {id : "spent-xp", value : 0},
		total : {id : "total-xp", value : 0}
	},
	
	health : {
		bashing1 : {id : "bashing-1", value : "Empty"},
		bashing2 : {id : "bashing-2", value : "Empty"},
		bashing3 : {id : "bashing-3", value : "Empty"},
		injured : {id : "injured", value : "Empty"},
		maimed : {id : "maimed", value : "Empty"},
		takenOut : {id : "taken-out", value : "Empty"}
	},

	legend : {class : "legend-dots", rating : 3},

	callings : {
		calling1 : {id : "calling-1", name : "#1", rating : 1},
		calling2 : {id : "calling-2", name : "#2", rating : 2},
		calling3 : {id : "calling-3", name : "#3", rating : 3}
	},

	bonds: {id: "bonds-list", list: [["This is a bond.", 1]]},
	fatebindings: {id: "fatebinding-list", list: [["This is a Fatebinding.", "boon companion", 1, 0]]}
}

/* THIS SECTION IS FOR DISPLAYING THE CHARACTER */
function printCharacter() {
	// grab the character from localStorage
	if (localStorage.getItem("character")) mapCharacter(JSON.parse(localStorage.getItem("character")));

	// make a variable that we can use over and over to fill in the items
	let elementId;

	// print all the details card
	for (const detail in character.details) {
		elementId = document.getElementById(character.details[detail].id);
		elementId.innerText = character.details[detail].value;
	}
	
	// print the paths card
	for (const path in character.paths) {
		elementId = document.getElementById(character.paths[path].id);
		elementId.innerText = character.paths[path].value;
	}
	
	// print the deeds card
	for (const deed in character.deeds) {
		elementId = document.getElementById(character.deeds[deed].id);
		elementId.innerText = character.deeds[deed].value;
	}
	
	// print the lists (knacks, boons, purviews, titles, birthrights, notes)	
	for (const list in character.lists) {
		elementId = document.getElementById(character.lists[list].id);
		while(elementId.hasChildNodes()) {
			elementId.removeChild(elementId.firstChild);
		}
		const listArray = character.lists[list].list;
		for(let i=0; i<listArray.length; i++) {
			drawListItem(elementId, listArray[i]);
		}
	}
	
	// now I need to print all the attributes and skills, translating the rating into the number of dots to be filled
	for (const dotGroup in character.dots) {
		// now iterate through the individual group (skills or attributes)
		for (const dotItem in character.dots[dotGroup]) {
			for (let i=0;i<character.dots[dotGroup][dotItem].rating; i++) {
				elementId = document.getElementById(character.dots[dotGroup][dotItem].id);
				elementId.children[i].classList.add("full");
			}
		}
	}

	// print out the Skill Specialties
	elementId = document.querySelectorAll(".specialties");
	elementId.forEach((specialty) => {
		const skillName = specialty.id.slice(0, specialty.id.length-4);
		if (character.dots.skills[skillName].specialties != "") {
			specialty.innerText = character.dots.skills[skillName].specialties;
		} else specialty.innerText = "None";
		
	})

	// print out the XP values
	elementId = document.getElementById(character.xp.unspent.id);
	elementId.innerText = character.xp.unspent.value;
	elementId = document.getElementById(character.xp.spent.id);
	elementId.innerText = character.xp.spent.value;
	elementId = document.getElementById(character.xp.total.id);
	elementId.innerText = character.xp.total.value;
	
	// print out the heatlh conditions
	for (const healthCondition in character.health) {
		const elementId = document.getElementById(character.health[healthCondition].id);
		elementId.innerText = character.health[healthCondition].value;
		
		// enable the other two bashing buttons if Stamina is high enough
		if (character.dots.attributes.stamina.rating < 4) {
			const bashingOne = document.getElementById("bashingOne");
			bashingOne.disabled = true;
		}
		if (character.dots.attributes.stamina.rating < 3) {
			const bashingTwo = document.getElementById("bashingTwo");
			bashingTwo.disabled = true;
		}
	}

	// print the current Virtue rating
	elementId = document.querySelectorAll(".virtue-dots");
	virtueDots[character.virtues.rating-1].classList.add("full");

	// print out Legend
	elementId = document.querySelectorAll(".legend-dots");
	for (i=0; i<character.legend.rating; i++) {
		elementId[i].classList.add("full");
	}

	// print out Callings
	// we'll do them in order
	elementId = document.getElementById(character.callings.calling1.id);
	elementId.innerText = character.callings.calling1.name;
	elementId = document.querySelectorAll(`.${character.callings.calling1.id}-dots`);
	for(i=0; i<character.callings.calling1.rating; i++) {
		elementId[i].classList.add("full");
	}
	// second calling
	elementId = document.getElementById(character.callings.calling2.id);
	elementId.innerText = character.callings.calling2.name;
	elementId = document.querySelectorAll(`.${character.callings.calling2.id}-dots`);
	for(i=0; i<character.callings.calling2.rating; i++) {
		elementId[i].classList.add("full");
	}
	// third calling
	elementId = document.getElementById(character.callings.calling3.id);
	elementId.innerText = character.callings.calling3.name;
	elementId = document.querySelectorAll(`.${character.callings.calling3.id}-dots`);
	for(i=0; i<character.callings.calling3.rating; i++) {
		elementId[i].classList.add("full");
	}

	// print out the character Birthrights
	elementId = document.getElementById(character.birthrights.id);
	while(elementId.hasChildNodes()) {
		elementId.removeChild(elementId.firstChild);
	}
	for(const birthright of character.birthrights.list) {
		displayBirthright(birthright[0], birthright[1]);
	}

	// need to calculate the combat numbers and put them on the sheet
	elementId = document.getElementById("movement");
	let combatNum = 0;
	if (character.dots.attributes.might.rating > character.dots.attributes.dexterity.rating) combatNum = character.dots.skills.athletics.rating + character.dots.attributes.might.rating;
	else combatNum = character.dots.skills.athletics.rating + character.dots.attributes.dexterity.rating;
	elementId.innerText = combatNum;

	elementId = document.getElementById("defense");
	elementId.innerText = Math.max(character.dots.attributes.stamina.rating,
		character.dots.attributes.resolve.rating,
		character.dots.attributes.composure.rating);

	// before I can print the bonds and fatebindings, I need to remove the current list items
	const bondsLi = document.getElementById("bonds-list");
	while (bondsLi.firstChild) bondsLi.removeChild(bondsLi.firstChild);
	const fatebindingsLi = document.getElementById("fatebinding-list");
	while (fatebindingsLi.firstChild) fatebindingsLi.removeChild(fatebindingsLi.firstChild);

	// print the bonds the character has
	for (bond of character.bonds.list) {
		printBond(bond);
	}

	// print the fatebindings the character has
	for (fatebinding of character.fatebindings.list) {
		printFatebinding(fatebinding);
	}
}

/* THIS SECTION IS FOR SAVING THE CHARACTER */
const saveButton = document.getElementById("save-character");
saveButton.addEventListener("click", saveCharacter);

// function to save the character
function saveCharacter() {
	// I want to save the character object to the client database.
	// I think it would have been easier if each edit also changed the corresponding value in the character object,
	// but I think the setup I have doesn't lend itself to that easily. It will be easier to understand the code
	// if all saving functionality is right here.

	// save the character details card
	for (property in character.details) {
		const elementId = document.getElementById(character.details[property].id);
		character.details[property].value = elementId.innerText;
	}

	// save the paths card
	for (path in character.paths) {
		const elementId = document.getElementById(character.paths[path].id);
		character.paths[path].value = elementId.innerText;
	}

	// save the deeds card
	for (deed in character.deeds) {
		const elementId = document.getElementById(character.deeds[deed].id);
		character.deeds[deed].value = elementId.innerText;
	}

	// now things get a bit more complicated. THE DOTS! Meaning skills and attributes. Nested loops?
	// well, it took a little bit of time to figure that out, but it wasn't as hard as I thought
	for (dotGroup in character.dots) {
		for (eachAbility in character.dots[dotGroup]) {
			const dotNodes = document.getElementById(character.dots[dotGroup][eachAbility].id).childNodes;
			let rating = 0;
			dotNodes.forEach((dot) => {
				if (dot.nodeName != "#text") {
					if (dot.classList.contains("full")) rating++;
				}
			});

			// update the dot rating
			character.dots[dotGroup][eachAbility].rating = rating;
		}
	}
	// I added Skill specialties and they need to be saved as well
	const skillSpecialties = document.querySelectorAll(".specialties");
	skillSpecialties.forEach((specialty) => {
		const skillName = specialty.id.slice(0, specialty.id.length-4);
		character.dots.skills[skillName].specialties = specialty.innerText;
	});
	
	// time to save the legend
	const legendDots = document.querySelectorAll(`.${character.legend.class}`);
	let rating = 0;
	legendDots.forEach((dot) => {
		if (dot.classList.contains("full")) rating++;
	});
	character.legend.rating = rating;
	
	// now to save the virtues!
	character.virtues.virtue1 = document.getElementById("virtue1").innerText;
	character.virtues.virtue2 = document.getElementById("virtue2").innerText;
	const virtueDots = document.querySelectorAll(".virtue-dots");
	rating = 1;
	virtueDots.forEach((dot) => {
		if (dot.classList.contains("full")) character.virtues.rating = rating;
		rating++;
	});

	// now to save the lists! Knacks, Purviews and Boons, Titles, Notes
	for (listGroup in character.lists) {
		const listItems = document.getElementById(character.lists[listGroup].id).childNodes;
		let listArray = [];
		listItems.forEach((item) => {
			// the nodeList has text as the first one, which I do not want
			if (item.nodeName != "#text") {
				// the innerText value has the button's X in it. I don't want that, either
				let listString;
				if (isEditing === false) listString = item.innerText;
				else listString = item.innerText.slice(0, item.innerText.length-1);
				listArray.push(listString);
			}
		});
		character.lists[listGroup].list = listArray;
	}

	// now to save the callings! I'm so close to being done, I can taste it! It tastes like victory. And morning breath.
	// lets save the calling names first
	character.callings.calling1.name = document.getElementById("calling-1").innerText;
	character.callings.calling2.name = document.getElementById("calling-2").innerText;
	character.callings.calling3.name = document.getElementById("calling-3").innerText;

	// save the calling dots
	let callingDots = document.querySelectorAll(".calling-1-dots");
	rating = 0;
	callingDots.forEach((dot) => {
		if (dot.classList.contains("full")) rating++;
	});
	character.callings.calling1.rating = rating;

	callingDots = document.querySelectorAll(".calling-2-dots");
	rating = 0;
	callingDots.forEach((dot) => {
		if (dot.classList.contains("full")) rating++;
	});
	character.callings.calling2.rating = rating;

	callingDots = document.querySelectorAll(".calling-3-dots");
	rating = 0;
	callingDots.forEach((dot) => {
		if (dot.classList.contains("full")) rating++;
	});
	character.callings.calling3.rating = rating;

	// now for the easiest one! XP!
	character.xp.unspent.value = document.getElementById(character.xp.unspent.id).innerText;
	character.xp.spent.value = document.getElementById(character.xp.spent.id).innerText;
	character.xp.total.value = document.getElementById(character.xp.total.id).innerText;

	// and, for my final act, let's save the Health track!
	character.health.bashing1.value = document.getElementById(character.health.bashing1.id).innerText;
	character.health.bashing2.value = document.getElementById(character.health.bashing2.id).innerText;
	character.health.bashing3.value = document.getElementById(character.health.bashing3.id).innerText;
	character.health.injured.value = document.getElementById(character.health.injured.id).innerText;
	character.health.maimed.value = document.getElementById(character.health.maimed.id).innerText;
	character.health.takenOut.value = document.getElementById(character.health.takenOut.id).innerText;

	// I don't need to grab the Birthrights in this function, because that functionality does what I should have done in the beginning and 
	// saves the info to the character object with the Birthrights are added or deleted from the DOM
	// Bonds and Fatebindings do the same.

	// first iteration of this app will just use localStorage as I'm not supporting more than one character 
	// I'll want to upgrade to a database to support multiple characters
	localStorage.setItem("character", JSON.stringify(character));
}

/* THIS SECTION IS FOR THE EDIT BUTTONS */

// grab all the edit buttons on the page because we'll add event listeners to them
const editButtons = document.querySelectorAll("button.edit");

// creating a function to place the input element to edit values
function createInput (event) {
	// a button is pushed and we need to grab a handle on the span next to it
	const childNodes = event.target.parentNode.childNodes;
	const inputSpan = childNodes[1];
	const oldValue = inputSpan.innerText;
	inputSpan.innerText = "";
	const input = document.createElement("input");
	input.setAttribute("type", "text");
	input.setAttribute("value", oldValue);
	inputSpan.appendChild(input);
	input.focus();
	input.select();

	// the input needs to listen for the enter key
	input.addEventListener("keydown", editTextValue);
}

// create a function to edit the values
function editTextValue (event) {
	if (event.key === "Enter") {
			const newName = event.target.value;
			const parentSpan = event.target.parentNode;
			parentSpan.innerText = newName;
	}
}

// add event listeners to all the buttons
editButtons.forEach((button) => {
	button.addEventListener("click", createInput);
});

/* THIS SECTION IS FOR THE KNACK/PURVIEW/BOON LISTS */

// grab handles to all the add buttons
const addButtons = document.querySelectorAll("button.add");

// genericising the event handlers so they can handle all three lists
function addListItem(event) {
	const buttonId = event.target.id;
	const listId = `${buttonId}-list`;
	const characterList = document.getElementById(listId);

	// create an input field and put it at the end of the list
	const input = document.createElement("input");
	input.setAttribute("type", "text");
	characterList.appendChild(input);
	input.focus();

	// create the event listener for the input to add the entered value to the list
	input.addEventListener("keydown", (event) => {
		if (event.key === "Enter") {
			drawListItem(event.target.parentNode, event.target.value);
			const parent = input.parentNode;
			parent.removeChild(input);
		}
	});
}

// need to externalize the adding of a list item with delete button so that I can call it when I redraw the character
function drawListItem(element, text) {
	const newItem = document.createElement("li");
	newItem.innerText = text;

	// add a delete button
	const deleteButton = document.createElement("button");
	deleteButton.innerText = "X";
	deleteButton.className = "delete lockable";
	if (isEditing === false) deleteButton.disabled = true;
	newItem.appendChild(deleteButton);
	element.appendChild(newItem);

	// add the delete button event listener to remove the knack
	deleteButton.addEventListener("click", (event) => {
		const item = event.target.parentNode;
		const parent = item.parentNode;
		parent.removeChild(item);
	});
}

// add event listeners to all the buttons
addButtons.forEach((button) => {
	button.addEventListener("click", addListItem);
});

/* THIS SECTION IS TO HANDLE ATTRIBUTES */
const attrDots = document.querySelectorAll(".attr-dots");
attrDots.forEach((span) => {
	span.addEventListener("click", (event) => {
		if (isEditing) {
			// make sure we don't toggle the class of the containing div, only the dots
			if (event.target.classList.contains("dot")) event.target.classList.toggle("full");
		}
	});
});

/* THIS SECTION IS FOR SKILL SPECIALTIES */ 
const skillSpecialties = document.querySelectorAll(".specialties");
skillSpecialties.forEach((skill) => {
	skill.addEventListener("click", (specialty) => {
		if (isEditing) {
			const input = document.createElement("input");
			input.setAttribute("type", "text");
			const inputPara = document.getElementById("specialtiesEditor");
			input.value = specialty.target.innerText;
			inputPara.appendChild(input);
			input.focus();
			input.select();

			// add the even listener to the input. I have this exact function all over the place. I should combine them later
			input.addEventListener("keydown", (event) => {
				if (event.key === "Enter") {
					specialty.target.innerText = input.value;
					input.remove();
				}
			});
		}	
	});
});

/* THIS SECTION HANDLES THE VIRTUES */
const virtueDots = document.querySelectorAll(".virtue-dots");
virtueDots.forEach((span) => {
	span.addEventListener("click", (event) => {
		// don't need to check if they have the dot class anymore as the selector only gets those that also have the dot class
		if (isEditing) {
		virtueDots.forEach((span) => {
			span.classList.remove("full");
		});

		// we've cleared all the dots, now fill in the click target
		event.target.classList.add("full");
	}
	});
});

// add event listeners to the buttons for the virtues
const virtueButtons = document.querySelectorAll(".virtue-button");
virtueButtons.forEach((button) => {
	button.addEventListener("click", () => {
		// create an input
		const input = document.createElement("input");
		const virtueInputP = document.getElementById("virtue-input");
		input.setAttribute("type", "text");
		virtueInputP.appendChild(input);
		input.focus();

		// set the event listener for the input
		input.addEventListener("keydown", (event) => {
			if (event.key === "Enter") {
			button.innerText = event.target.value;
			virtueInputP.removeChild(input);
			}
		});
	});
});

/* THIS SECTION IS FOR XP */
const addButton = document.getElementById("add-xp");
const spendButton = document.getElementById("spend-xp");
const xpInput = document.getElementById("xp-input");

// adding XP
addButton.addEventListener("click", () => {
	const input = document.createElement("input");
	input.setAttribute("type", "number");
	xpInput.appendChild(input);
	input.focus();

	// add event listener for the input
	input.addEventListener("keydown", (event) => {
		if (event.key === "Enter") {
			const addedXp = event.target.value;
			xpInput.removeChild(input);
			const totalXp = document.getElementById("total-xp");
			const unspentXp = document.getElementById("unspent-xp");
			totalXp.innerText = Number(totalXp.innerText) + Number(addedXp);
			unspentXp.innerText = Number(unspentXp.innerText) + Number(addedXp);
		}
	});
});

// spending XP
spendButton.addEventListener("click", () => {
	const input = document.createElement("input");
	input.setAttribute("type", "number");
	xpInput.appendChild(input);
	input.focus();

	// add event listener for the input
	input.addEventListener("keydown", (event) => {
		if(event.key === "Enter") {
			const spendXp = Number(event.target.value);
			xpInput.removeChild(input);
			const unspentXp = document.getElementById("unspent-xp");
			const spentXp = document.getElementById("spent-xp");
			unspentXp.innerText = Number(unspentXp.innerText) - spendXp;
			spentXp.innerText = Number(spentXp.innerText) + spendXp;
		}
	});
});

/* THIS SECTION IS FOR LEGEND */
const legendDots = document.querySelectorAll(".legend-dots");
legendDots.forEach((dot) => {
	dot.addEventListener("click", (event) => {
		if (isEditing) {
		event.target.classList.toggle("full");
		}
	});
});

/* THIS SECTION IS FOR THE CALLINGS */

// grab handles to the elements needed for the Callings card
const inputPara = document.getElementById("callingInput");
const callingButton1 = document.getElementById(character.callings.calling1.id);
const callingButton2 = document.getElementById(character.callings.calling2.id);
const callingButton3 = document.getElementById(character.callings.calling3.id);

// function to provide the renaming calling functionality
function renameCalling (button) {
	const input = document.createElement("input");
	input.setAttribute("type", "text");
	inputPara.appendChild(input);
	input.focus();

	// create the event listener for the input
	input.addEventListener("keydown", (event) => {
		if (event.key === "Enter") {
			button.innerText = event.target.value;
			input.remove();
		}
	});
}

// add the calling button event listeners
callingButton1.addEventListener("click", () => renameCalling(callingButton1));
callingButton2.addEventListener("click", ()=> renameCalling(callingButton2));
callingButton3.addEventListener("click", () => renameCalling(callingButton3)); 

// add event listeners to the Callings dots
const calling1Dots = document.querySelectorAll(".calling-1-dots");
const calling2Dots = document.querySelectorAll(".calling-2-dots");
const calling3Dots = document.querySelectorAll(".calling-3-dots");

calling1Dots.forEach((dot) => {
	dot.addEventListener("click", (event) => {
		if (isEditing) {
		event.target.classList.toggle("full");
		}
	});
});
calling2Dots.forEach((dot) => {
	dot.addEventListener("click", (event) => {
		if (isEditing){
		event.target.classList.toggle("full");
		}
	});
});
calling3Dots.forEach((dot) => {
	dot.addEventListener("click", (event) => {
		if (isEditing) {
		event.target.classList.toggle("full");
		}
	});
});

/* THIS SECTION IS FOR THE MODAL BOX USED TO GET INPUT */ 
function createModal() {
	// check to see if the modal already exists. We don't want more than one on the screen at a time
	if (document.getElementById("modalInput")) return;

	// This function will create the modal box and return it to the calling function for customization
	const box = document.createElement("div");
	box.style.position = "fixed";
	box.style.zIndex = 1;
	box.style.left = "10px";
	box.style.top = "0px";
	box.style.background = "#D9E9F0";
	box.style.padding = ".5em";
	box.style.border = "3px solid #2E647B";
	box.style.borderRadius = "5px";
	box.style.boxShadow = "#2e647b 5px 5px 5px";
	box.id = "modalInput";

	// create the form that the calling function will use to customize the box
	const form = document.createElement("form");
	box.appendChild(form);

	// create the other buttons we'll need for the box
	const okButton = document.createElement("button");
	okButton.type = "button";
	okButton.innerText = "Ok";
	okButton.id = "modalOk";
	box.appendChild(okButton);
	const cancelButton = document.createElement("button");
	cancelButton.type = "button";
	cancelButton.innerText = "Cancel";
	cancelButton.id = "modalCancel";
	box.appendChild(cancelButton);

	const sheet = document.getElementById("character-sheet");

	// append the box to the document
	sheet.appendChild(box);

	// handle clicks on the cancel button
	cancelButton.addEventListener("click", () => box.remove());

	// the calling function will need to handle the Ok button event
	return box;
}

/* THIS SECTION IS FOR BIRTHRIGHTS */ 
// They don't quite fit into the Dots or the Lists for the character, so I'll handle them as their own thing.
const birthrightsList = document.getElementById("birthrights-list");
const addBirthButton = document.getElementById("birthrights");

// event listener for the addBirthButton so we can add Birthrights to the list
addBirthButton.addEventListener("click", () => {
	// we need to make the inputs to get the info for the new Birthright
	const birthName = document.createElement("input");
	const nameLabel = document.createElement("label");
	birthName.type = "text";
	nameLabel.innerText = "Birthright Name:";
	const birthRating = document.createElement("input");
	const ratingLabel = document.createElement("label");
	birthRating.type = "number";
	birthRating.max = 5;
	birthRating.min = 1;
	ratingLabel.innerText = "Birthright Rating:";
	const lineBreak = document.createElement("br");
	const button = document.createElement("button");
	button.innerText = "Add";

	// I'll try to make a modal box to input the birthright. It's more complicated and creating the inputs to appear in the character sheet looks really ugly.
	const modalDiv = document.createElement("div");
	modalDiv.style.position = "fixed";
	modalDiv.style.zIndex = 1;
	modalDiv.style.left = "10%";
	modalDiv.style.top = "30%";
	modalDiv.style.background = "#D9E9F0";
	modalDiv.style.width = "60%";
	modalDiv.style.minWidth = "390px";
	modalDiv.style.padding = "1em";
	modalDiv.style.border = "3px solid #2E647B";
	modalDiv.style.borderRadius = "5px";
	modalDiv.style.boxShadow = "#2e647b 5px 5px 5px";
	modalDiv.appendChild(nameLabel);
	modalDiv.appendChild(birthName);
	modalDiv.appendChild(lineBreak);
	modalDiv.appendChild(ratingLabel);
	modalDiv.appendChild(birthRating);
	modalDiv.appendChild(button);
	birthrightsList.appendChild(modalDiv);
	birthName.focus();
	birthRating.value = 1;

	// add the event listener for the Add button
	button.addEventListener("click", () => {
		// do some value checks first
		let name = birthName.value;
		let rating = Number(birthRating.value);
		if (rating > 5) rating = 5;
		if (rating < 1) rating = 1;
		if (name === "") name = "Birthright";

		// grab the values and assign them to the character object
		const birthrightArray = [name, rating];
		character.birthrights.list.push(birthrightArray);
		
		// now that we've saved the new Birthright to the character object, we need to display it.
		displayBirthright(name, rating);
		modalDiv.remove();
	});
});

function displayBirthright(name, rating) {
	const newItem = document.createElement("li");
		newItem.innerText = name;
		for (i=0; i<rating; i++)
		{
			const dot = document.createElement("span");
			dot.classList.add("dot");
			dot.classList.add("full");
			dot.style.marginLeft = "3px";
			newItem.appendChild(dot);
		}
		
		// also need to add a delete button to the item
		const deleteButton = document.createElement("button");
		deleteButton.classList.add("delete", "lockable");
		deleteButton.innerText = "X";
		if (isEditing === false) deleteButton.disabled = true;
		newItem.appendChild(deleteButton);
		birthrightsList.appendChild(newItem);
		

		// add in the event listener for the delete button
		deleteButton.addEventListener("click", (event) =>{
			const eventParent = event.target.parentNode;
			const text = eventParent.innerText.slice(0, eventParent.innerText.length-1);
			for(i=0; i<character.birthrights.list.length; i++){
				if (character.birthrights.list[i][0] === text) character.birthrights.list.splice(i, 1);
			}
			eventParent.remove();

		});
}

/* THIS SECTION IS FOR BONDS */ 
const addBondButton = document.getElementById("bonds");

addBondButton.addEventListener("click", () => {
	// call the function to create our modal box
	const box = createModal();
	// don't go any further if it returned early
	if (box === undefined) return;

	// grab a handle on the form inside the box to customize it
	const form = box.querySelector("form");

	// create the inputs that we want
	const characterName = document.createElement("input");
	characterName.type = "text";
	characterName.id = "bondName";
	const nameLabel = document.createElement("label");
	nameLabel.innerText = "Character Name:";
	nameLabel.htmlFor = "bondName";
	const bondLevel = document.createElement("input");
	bondLevel.type = "number";
	bondLevel.min = 0;
	bondLevel.id = "bondLevel";
	const bondLabel = document.createElement("label");
	bondLabel.htmlFor = "bondLevel";
	bondLabel.innerText = "Bond Level:";
	const lineBreak = document.createElement("br");

	// now we need to put the inputs and labels on the box
	form.appendChild(nameLabel);
	form.appendChild(characterName);
	form.appendChild(lineBreak);
	form.appendChild(bondLabel);
	form.appendChild(bondLevel);

	// put the focus on the first input
	characterName.focus();

	// now I need to handle the Ok button click
	const okButton = document.getElementById("modalOk");
	okButton.addEventListener("click", () => {
		// add the data to the character object
		const charName = characterName.value;
		const charLevel = Number(bondLevel.value);
		const newBond = [charName, charLevel];
		character.bonds.list.push(newBond);
		box.remove();
		printBond(newBond);
	});
	
});

// need a function to print the bonds that printCharacter can call
function printBond(newBond) {
	// add the new bond to the displayed sheet
	const newItem = document.createElement("li");
	const newStrong = document.createElement("strong");
	newStrong.innerText = newBond[0];
	newItem.appendChild(newStrong);
	const newSpan = document.createElement("span");
	newSpan.innerText = `, Pool: ${newBond[1]}`;
	newItem.appendChild(newSpan);
	const bondsList = document.getElementById("bonds-list");
	bondsList.appendChild(newItem);
	const deleteButton = document.createElement("button");
	deleteButton.innerText = "X";
	deleteButton.classList.add("delete", "lockable");
	if (isEditing === false) deleteButton.disabled = true;
	newItem.appendChild(deleteButton);

		// event handler for the delete button
		deleteButton.addEventListener("click", (event) => {
			// first grab reference to the parent LI of the element clicked, then the STRONG element with the name
			const parentNode = event.target.parentElement;
			const eventName = parentNode.querySelector("strong").innerText;

			// now we need to delete the element from the DOM and remove the fatebinding from the character array
			parentNode.remove();
			for (i=0; i<character.bonds.list.length; i++) {
				if (character.bonds.list[i][0] === eventName) character.bonds.list.splice(i, 1);
			}
		});

}

/* THIS SECTION IS FOR FATEBINDINGS */
const addFatebinding = document.getElementById("fatebindings");

addFatebinding.addEventListener("click", () => {
	// create an input box
	const inputBox = createModal();

	// grab a handle to the form on the box to populate it with the fields we need
	const boxForm = inputBox.querySelector("form");

	// create the fields we need and put them on the box
	const fatebindingName = document.createElement("input");
	fatebindingName.type = "text";
	fatebindingName.id = "fatebindingName";
	const fbNameLabel = document.createElement("label");
	fbNameLabel.htmlFor = "fatebindingName";
	fbNameLabel.innerText = "Fatebinding Name:";
	const fatebindingRole = document.createElement("select");
	fatebindingRole.name = "fbRolls";
	fatebindingRole.id = "fbRolls";
	const roles = ["apprentice", "balm", "boon companion", "canary", "martyr", "jinx", "nemesis", "paramour", "rival", "traitor", "worshipper", "unrequited paramour"];
	for (role of roles) {
		const roleDisplay = role[0].toUpperCase() + role.slice(1);
		fatebindingRole.options.add(new Option(roleDisplay, role));
	}
	const fatebindingStrength = document.createElement("input");
	fatebindingStrength.type = "number";
	fatebindingStrength.min = 1;
	fatebindingStrength.max = 5;
	fatebindingStrength.value = 1;
	fatebindingStrength.id = "fatebindingStrength";
	const fbStrengthLabel = document.createElement("label");
	fbStrengthLabel.htmlFor = "fatebindingStrength";
	fbStrengthLabel.innerHTML = "Fatebinding Strength:";
	const lineBreak = document.createElement("br");

	boxForm.appendChild(fbNameLabel);
	boxForm.appendChild(fatebindingName);
	boxForm.appendChild(fatebindingRole);
	boxForm.appendChild(lineBreak);
	boxForm.appendChild(fbStrengthLabel);
	boxForm.appendChild(fatebindingStrength);
	fatebindingName.focus();

	boxOk = document.getElementById("modalOk").addEventListener("click", () => {
		// first we'll get the relevant data and put it into the character object
		const newFb = [fatebindingName.value, fatebindingRole.value, Number(fatebindingStrength.value), 0];
		character.fatebindings.list.push(newFb);
		inputBox.remove();

		printFatebinding(newFb);

	});
});

// we need a function to print the fatebinding to the list so that printCharacter can call it
function printFatebinding(newFb) {
	// next we create the elements and add them to the list on the page
	const newItem = document.createElement("li");
		const strongName = document.createElement("strong");
		strongName.innerText = newFb[0];
		newItem.appendChild(strongName);
		const detailSpan = document.createElement("span");
		detailSpan.innerHTML = `<br/>Role: ${newFb[1][0].toUpperCase() + newFb[1].slice(1)}<br/>Strength: ${newFb[2]}<br/>`;
		newItem.appendChild(detailSpan);
		const imperilCheck = document.createElement("input");
		imperilCheck.type = "checkbox";
		imperilCheck.disabled = true;
		const imperilLabel = document.createElement("label");
		imperilLabel.innerText = "Imperiled?";
		newItem.appendChild(imperilLabel);
		newItem.appendChild(imperilCheck);
		const fatebindingList = document.getElementById("fatebinding-list");
		const deleteButton = document.createElement("button");
		deleteButton.innerText = "X";
		deleteButton.classList.add("delete", "lockable");
		if (isEditing === false) deleteButton.disabled = true;
		newItem.appendChild(deleteButton);
		fatebindingList.appendChild(newItem);

		// I need to handle the delete button. This could be a challenge
		deleteButton.addEventListener("click", (event) => {
			// first grab reference to the parent LI of the element clicked, then the STRONG element with the name
			const parentNode = event.target.parentElement;
			const eventName = parentNode.querySelector("strong").innerText;

			// now we need to delete the element from the DOM and remove the fatebinding from the character array
			parentNode.remove();
			for (i=0; i<character.fatebindings.list.length; i++) {
				if (character.fatebindings.list[i][0] === eventName) character.fatebindings.list.splice(i, 1);
			}
		});
}

/* THIS SECTION IS FOR THE EDIT CHARACTER BUTTON */ 
// The idea is to be able to lock the edit functions and unlock them for ease of play
let isEditing = true;
const editLock = document.getElementById("edit-lock");

editLock.addEventListener("click", (event) => {
	saveCharacter();
	if (isEditing === true) {
		event.target.innerText = "Edit Character";
		isEditing = false;
		const editButtons = document.querySelectorAll(".lockable");
		editButtons.forEach((button) => {
			button.disabled = true;
		});
	}else {
		event.target.innerText = "Lock Character";
		isEditing = true;
		const editButtons = document.querySelectorAll(".lockable");
		
		editButtons.forEach((button) => {
			button.disabled = false;
		});
	}
	printCharacter();
});

// testing downloading the character as a JSON
const downloadButton = document.getElementById("download-char");
downloadButton.addEventListener("click", () => {
	// we need to save the character, first, to make sure all the changes in the DOM are in the object
	saveCharacter();
	const downloadFile = new Blob([JSON.stringify(character)], {type: "text/plain"});
	const link = document.createElement("a");
	const url = URL.createObjectURL(downloadFile);
	link.href = url;
	link.download = `${character.details.name.value}.scion`;
	link.click();
});

// We successfully download a character, now we need to support uploading!
const uploadButton = document.getElementById("upload-char");
uploadButton.addEventListener("click", () => {
	const input = document.createElement("input");
	input.type = "file";
	input.accept = ".scion";
	input.click();
	input.addEventListener("change", () => {
		const characterFile = input.files[0];
		let charPromise = characterFile.text();
		charPromise.then((result) => {
			mapCharacter(JSON.parse(result));
			printCharacter();
		});
	});
});

/* THIS SECTION IS FOR MAPPING THE SAVED CHARACTER OBJECT ONTO THE CURRENT OBJECT */
// A problem I've come up against is that the character object is expanding as I add to it and the character object saved in browsers
// does not have all the upgraded features. As I'm currently just copying the saved object into the object in the code, I lose all 
// those upgrades. I don't want that functionality. I need to take previously stored objects and map them onto the current object
// structure defined in the app.

function mapCharacter(savedCharacter) {
	// The character passed to the function is meant to be the character retrieved from storage
	// I need to iterate somehow through the character object in the app and map the character passed to the function onto it
	// I can iterate through it much like saving a character I think. I'll make sure that all properties of the character object
	// have default values so that if they *don't* exist in the saved character, there will be something to display. 
	// This function only supports upgrades to the character object. If I were to decide to change its structure, this would
	// fall apart. Luckily, I don't plan on doing that.

	for (property in savedCharacter.details) character.details[property] = savedCharacter.details[property];
	for (property in savedCharacter.paths) character.paths[property] = savedCharacter.paths[property];
	for (property in savedCharacter.deeds) character.deeds[property] = savedCharacter.deeds[property];
	for (property in savedCharacter.dots.skills) character.dots.skills[property] = savedCharacter.dots.skills[property];
	for (property in savedCharacter.dots.attributes) character.dots.attributes[property] = savedCharacter.dots.attributes[property];
	for (property in savedCharacter.virtues) character.virtues[property] = savedCharacter.virtues[property];
	character.birthrights = savedCharacter.birthrights;
	for (property in savedCharacter.lists) character.lists[property] = savedCharacter.lists[property];
	for (property in savedCharacter.xp) character.xp[property] = savedCharacter.xp[property];
	for (property in savedCharacter.health) character.health[property] = savedCharacter.health[property];
	character.legend = savedCharacter.legend;
	for (property in savedCharacter.callings) character.callings[property] = savedCharacter.callings[property];
	character.bonds = savedCharacter.bonds;
	character.fatebindings = savedCharacter.fatebindings;
}

// load the character when the window loads
window.addEventListener("load", printCharacter);


/* THIS SECTION IS FOR MY TO-DO LIST AND FEATURE WISHLIST

* Add detection of Legend level and change the visual theme for each Tier
* Make the UI more attractive
* Add in Asset skills
* Add in Favored Approach
* Add functionality to select lower dots when higher dots are selected
* GENERICIZE MODAL BOX FUNCTION to support Bonds & Fatebindings as well as Birthrights
* Details for Callings
* Editable list items

WORKING ON: Modal box, Bonds, Fatebindings

*/
</script>
</html>